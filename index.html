<!DOCTYPE html>
<html lang="fr">
<head>
    <script src="https://www.paypal.com/sdk/js?client-id=AS98Y_IcGhbHjnlMwNJQddvNbcGDdqkWgYK8xNfMR2txTkTHpg_iwKigg6HsFa8Gg7c8J9bcuyaGRECA&currency=EUR"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription Buyer Meeting Lotte</title>
    <style>
        /* Vos styles existants ici */
        #paypal-button-container {
            display: none; /* Cacher le bouton PayPal au départ */
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Inscription Buyer Meeting Lotte</h1>
        <div class="logo-container">
            <img src="new logo.jpg" alt="Logo de l'entreprise">
        </div>
        <form id="buyer-meeting" method="POST" action="https://script.google.com/macros/s/AKfycbzzfGezwuf6tF3HQ4s0tkXbIubF0MbzZxr40ly05U7u08H0rpAiyfg05FX5V_v6NLUn/exec">
            <label>Nom complet :</label>
            <input type="text" name="nom_complet" required>
            <label>Nom de l'entreprise :</label>
            <input type="text" name="nom_entreprise" required>
            <label>Nom de la marque :</label>
            <input type="text" name="nom_marque" required>
            <label>Adresse e-mail du responsable :</label>
            <input type="email" name="email" required>
            <label>Numéro de téléphone :</label>
            <input type="tel" name="telephone" required>
            <label>Type de produits commercialisés :</label>
            <input type="text" name="type_produits" required>
            <button type="submit">Envoyer</button>
        </form>

        <!-- Bouton PayPal caché au départ -->
        <div id="paypal-button-container"></div>
    </div>

    <div id="loading-screen" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.8);
        justify-content: center;
        align-items: center;
        font-size: 20px;
        font-weight: bold;
        color: #022641;">
        ⏳ Envoi en cours, veuillez patienter...
    </div>

    <script>
    document.getElementById('buyer-meeting').addEventListener('submit', function(event) {
        event.preventDefault(); // Empêche l'envoi classique du formulaire

        // Afficher l'écran de chargement
        document.getElementById('loading-screen').style.display = 'flex';

        var formData = new FormData(event.target);

        fetch(event.target.action, {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            console.log('Réponse du serveur:', data);
            if (data.result === 'success') {
                // Cacher le formulaire et afficher le bouton PayPal
                document.getElementById('buyer-meeting').style.display = 'none';
                document.getElementById('paypal-button-container').style.display = 'block';
            } else {
                throw new Error('Erreur lors de l\'envoi. Veuillez vérifier vos informations.');
            }
        })
        .catch(error => {
            console.error('Erreur réseau ou serveur:', error);
            alert('Une erreur est survenue. Vérifiez votre connexion ou réessayez plus tard.');
        })
        .finally(() => {
            document.getElementById('loading-screen').style.display = 'none';
        });
    });

    // Configuration du bouton PayPal
    paypal.Buttons({
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: '600.00'  // Montant en euros
                    }
                }]
            });
        },
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                alert('Paiement effectué avec succès par ' + details.payer.name.given_name);
                window.location.href = '/merci.html';  // Redirection après paiement
            });
        },
        onError: function(err) {
            console.error(err);
            alert('Une erreur est survenue lors du paiement.');
        }
    }).render('#paypal-button-container');
    </script>
</body>
</html>
